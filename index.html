<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DHL eCommerce · Customer Master Data Viewer</title>

    <link rel="stylesheet" href="style.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
</head>

<body>
    <!-- Top bar -->
    <header class="topbar">
        <div class="topbar-left">
            <div class="brand">
                <div class="brand-mark" aria-label="DHL">DHL</div>
                <div class="brand-text">
                    <div class="brand-title">Customer Master Data Viewer</div>
                    <div class="brand-subtitle">DHL eCommerce · Scenarios · MDM Objects · Relationships</div>
                </div>
            </div>
        </div>

        <div class="topbar-right">
            <div class="dq-badge" id="dqBadge" title="Data Quality (computed from reference enums)">
                <span class="dq-dot" id="dqDot"></span>
                <span class="dq-text" id="dqText">DQ: N/A</span>
            </div>

            <button id="resetZoom" class="btn btn-secondary" title="Zoom-to-fit / reset view">Reset View</button>
        </div>
    </header>

    <div class="layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Scenario -->
            <section class="panel">
                <div class="panel-head">
                    <div class="panel-title">Scenario</div>
                    <div class="panel-badge" id="scenarioCount" title="Scenarios shown by filters">—</div>
                </div>

                <label class="field-label" for="scenarioSelector">Select scenario</label>
                <select id="scenarioSelector" class="select">
                    <option value="">-- Choose Scenario --</option>
                </select>

                <label class="field-label" for="nodeSearch">Search (ID / Name)</label>
                <input id="nodeSearch" class="input" type="text"
                    placeholder="e.g., CUST-..., ACC-..., CON-..., Inditex, Vinted, Shopify..." />

                <div class="hint">
                    Click a node to view its full JSON. Filters narrow the scenario list and highlight matches on the
                    graph.
                </div>
            </section>

            <!-- Filters -->
            <section class="panel">
                <div class="panel-head">
                    <div class="panel-title">Filters</div>
                    <div class="panel-note">Live filtering</div>
                </div>

                <div class="filter-grid">
                    <div class="filter-block">
                        <div class="field-label">Customer Type</div>
                        <select id="filterCustomerType" class="select" multiple size="6"></select>
                        <div class="field-note">From reference_master_data.json</div>
                    </div>

                    <div class="filter-block">
                        <div class="field-label">Industry</div>
                        <select id="filterIndustry" class="select" multiple size="6"></select>
                        <div class="field-note">From reference_master_data.json</div>
                    </div>

                    <div class="filter-block">
                        <div class="field-label">Sales Channel</div>
                        <select id="filterSalesChannel" class="select" multiple size="6"></select>
                        <div class="field-note">From reference_master_data.json</div>
                    </div>

                    <div class="filter-block">
                        <div class="field-label">Platform</div>
                        <select id="filterPlatform" class="select" multiple size="6"></select>
                        <div class="field-note">Derived from dataset</div>
                    </div>
                </div>

                <div class="filter-actions">
                    <button id="clearFilters" class="btn btn-outline" title="Clear all filters">Clear Filters</button>
                </div>

                <!-- Backward-compatible element; script still tolerates it if present -->
                <button id="applyFilters" style="display:none"></button>
            </section>

            <!-- View options -->
            <section class="panel">
                <div class="panel-head">
                    <div class="panel-title">View</div>
                    <div class="panel-note">What to show on cards</div>
                </div>

                <div class="toggle-grid">
                    <label class="toggle">
                        <input type="checkbox" id="showAddresses" checked />
                        <span>Addresses</span>
                    </label>

                    <label class="toggle">
                        <input type="checkbox" id="showContacts" checked />
                        <span>Contacts</span>
                    </label>

                    <label class="toggle">
                        <input type="checkbox" id="showReferenceIds" checked />
                        <span>Identifiers (Reference IDs)</span>
                    </label>

                    <label class="toggle">
                        <input type="checkbox" id="showPlatforms" checked />
                        <span>Platforms</span>
                    </label>
                </div>

                <div class="filter-actions">
                    <button id="collapseAll" class="btn btn-outline" title="Collapse all subtrees">Collapse All</button>
                    <button id="expandAll" class="btn btn-outline" title="Expand all subtrees">Expand All</button>
                </div>

                <!-- Compact mode removed. Keep hidden input for backward compatibility. -->
                <input type="checkbox" id="toggleCompact" style="display:none" />
            </section>

            <!-- Reference master data (enums) -->
            <section class="panel">
                <div class="panel-title">Reference Master Data</div>

                <details id="refEnumsPanel" open>
                    <summary class="details-summary">Enums (customerType / industry / channel / roles…)</summary>
                    <div class="details-body">
                        <pre id="refEnumsPreview" class="json-mini">{}</pre>
                    </div>
                </details>

                <details id="refColorsPanel">
                    <summary class="details-summary">Color Palette (reference_colors.json)</summary>
                    <div class="details-body">
                        <div id="colorSwatches" class="swatch-grid"></div>
                        <pre id="refColorsPreview" class="json-mini">{}</pre>
                    </div>
                </details>
            </section>

            <!-- Selected JSON -->
            <section class="panel json-panel">
                <div class="panel-title">Selected Object</div>
                <pre id="json-display" class="json-display">{}</pre>
            </section>
        </aside>

        <!-- Canvas -->
        <main class="canvas">
            <div class="viz-container" id="viz-container"></div>

            <div class="footer-note">
                Data sources:
                <code>/data/customerData.json</code>,
                <code>/data/reference_master_data.json</code>,
                <code>/data/reference_colors.json</code>
            </div>
        </main>
    </div>

    <script src="script.js"></script>

    <!-- UI-only helper: scenario count badge -->
    <script>
        (function () {
            const sel = document.getElementById('scenarioSelector');
            const badge = document.getElementById('scenarioCount');
            if (!sel || !badge) return;

            const update = () => {
                const count = Math.max(0, sel.options.length - 1); // exclude placeholder
                badge.textContent = String(count);
            };

            const mo = new MutationObserver(update);
            mo.observe(sel, { childList: true });
            update();
        })();
    </script>
</body>

</html>